var _Doneski=function(){var f=this;f.linger=1E3;f.list_name="default";f.separator="::";f.tag=function(h,c,k){h=document.createElement(h);if(!k&&typeof c=="string")k=c=undefined;if(c)for(var i in c)h.setAttribute(i,c[i]);if(k)h.innerHTML=k;return h};f.bind=function(h,c){c=c||f;return function(){h.apply(c,arguments)}};f.l=[];f.id="doneski";var q={_init:function(){f.lcon=(gtn=f.gtn)((l="list")+"s")[0];f.ln=gtn(l+"nav")[0];f.tb=t=gtn(tb="toolbar")[0];f.fudge=gtn("content")[0];if((ls="localStorage")in
(w=window)&&w[ls]!==null){f.touch();w.scrollTo(0,35);if(localStorage[l+"s"]){var h=w[ls][l+"s"].split(",");f.rollup();for(var c=0;c<h.length;c++)f.lL(h[c]);(h=w[ls]["last_"+l]?f.find(w[ls]["last_"+l]):f.l[0])||(h=f.l[0]);f.go(h)}else f.newList();f.sFH()}(ael=f.ael)("keyup",f.bkp,true);if(typeof TouchyFeely!="undefined"){f.toucher=new TouchyFeely(document,{mL:10,cscroll:0});ael((a="swipe")+"start",f.swS,true);ael(a+"move",f.swM,true);ael(a+"end",f.swE,true);ael((a="scroll")+"start",f.scS,true);ael(a+
"move",f.scM,true);ael(a+"end",f.scE,true)}(st=w.setTimeout)(function(){f.gtn("body")[0].className+=" loaded"},200);st(function(){f.cachedTexture(tb,f.ns,{opacity:0.3,range:50},tb)},0);st(function(){f.cachedTexture("body "+l+"s "+l,f.nb,{bg:{position:"20px top",repeat:"repeat-y"}},"nb")},0);st(function(){f.cachedTexture("body header",f.nb,{bg:{position:"20px top",repeat:"repeat-y"}},"nb")},0);w.scrollTo(0,0);w[ls][j+"started"]=1;f.loaded=f.do_journal=f.do_sync=true;f.needsSync=1;f.sync()},ael:function(h,
c,k){return document.addEventListener(h,c,k)},gtn:function(h){return document.getElementsByTagName(h)},ns:function(h,c,k,i){c={opacity:0.2,range:100};if(h)for(var n in h)c[n]=h[n];if(!(d=document)[ce="createElement"]("canvas").getContext)return false;i=(k=d[ce]("canvas")).getContext("2d");k.width=c.width||960;k.height=c.height||30;for(h=0;h<k.width;h++)for(n=0;n<k.height;n++){var p=Math.floor(Math.random()*c.range);i.fillStyle="rgba("+p+","+p+","+p+","+c.opacity+")";i.fillRect(h,n,1,1)}return"url("+
k.toDataURL("image/png")+")"},nb:function(h,c,k,i,n,p){if(!(i=document)[ce="createElement"]("canvas").getContext)return false;p=(n=i[ce]("canvas")).getContext("2d");n.width=4;n.height=1;p.fillStyle="rgba(236,0,140,.2)";p.fillRect(0,0,1,1);p.fillRect(3,0,1,1);return"url("+n.toDataURL("image/png")+")"},cachedTexture:function(h,c,k,i,n,p,r){i&&(w=window)[ls="localStorage"][i="tx."+i]&&(p=w[ls][i]);n={bg:{repeat:"no-repeat",position:"left top"}};if(k)for(r in k)n[r]=k[r];if(!p){p=c(k);w[ls][i]=p}(st=
f.styles()).innerHTML+=h+"{"+(b="background-")+"image:"+p+";";for(r in bg=n.bg)st.innerHTML+=b+r+":"+bg[r]+";";st.innerHTML+="}\n";return true},styles:function(){if(f.css)return f.css;f.css=(d=document).createElement("style");d.getElementsByTagName("head")[0].appendChild(f.css);return f.css},swS:function(){(g=(f.swT=f.cL)["get"+(a="Attribute")]("style")||"").indexOf(w="-webkit-transform:translate3d(");f.swiping=true},swM:function(){},swE:function(h){(function(c){window.setTimeout(function(){c.removeAttribute("style")},
200)})(f.swT);h.direction=="left"?f.goN():f.goP()},scS:function(){if((a=(f.scT=f.cL).getAttribute("style")||"").indexOf(w="-webkit-transform:translate3d(")==-1){f.scT.setAttribute("style",a+w+"0px,0px,0px);-webkit-transition:none;");f.scS=0}else f.scS=parseInt(a.replace(/.*-webkit-transform:translate3d\((-)?[0-9]{1,5}(px)?,((-)?[0-9]{1,5})(px)?,.*/,"$3"),10)},scM:function(h,c){c=(e=f.scS+h.dY)>0?0:e<(d=f.mSc())?d:e;f.scT.setAttribute("style",f.scT.getAttribute("style").replace(/-webkit-transform:translate3d\(((-)?[0-9]{1,5}(px)?),(-)?[0-9]{1,5}(px)?,/,
"-webkit-transform:translate3d($1,"+c+"px,"))},scE:function(){f.scT.setAttribute("style",f.scT.getAttribute("style").replace("-webkit-transition:none;",""))},mSc:function(){return 0-f.scT.clientHeight+window.innerHeight},lL:function(h,c,k,i){(k=new Doneski.List(h)).nav_item=i=new Doneski.ListNav(k);f.addList(k.id);c&&(k.className+=c);f.lcon.appendChild(k);f.ln.appendChild(i);f.rN();return k},addList:function(h){f.l.push(window.o_register[h]||f.lL(h))},rN:function(){ln=f.ln;if(ln.clientWidth>f.tb.clientWidth*
0.9){a="tight";for(o=4;o--;)ln.className=ln.className.replace(a+(o-1),a+o)}},newList:function(h){h=f.lL(f.gLId(),"after");f.go(h)},find:function(h){for(var c=0;c<f.l.length;c++)if(f.l[c].id==h)return f.l[c]},go:function(h){for(var c="",k=0;k<f.l.length;k++)if(f.l[k]!=h)f.l[k].deactivate(c);else{f.l[k].activate();c="after"}f.cL=h;f.sFH();localStorage.last_list=h.id},sFH:function(){if((s=f.styles())&&s.innerHTML.indexOf("/*fudge heights*/")==-1)f.styles().innerHTML+="\n/*fudge heights*/content,lists list{min-height:"+
window.innerHeight+"px;}";else f.styles().innerHTML.replace("\n/*fudge heights*/content,lists list{[^}]+}","\n/*fudge heights*/content,lists list{min-height:"+window.innerHeight+"px;}")},goN:function(){var h=f.l.indexOf(f.cL)+1;h>=f.l.length?f.newList():f.go(f.l[h])},goP:function(){var h=f.l.indexOf(f.cL)-1;h>=0&&f.go(f.l[h])},gTId:function(){return"t_"+f.gUU()},gLId:function(){return"l_"+f.gUU()},gUU:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(h){var c=Math.random()*
16|0;return(h=="x"?c:c&3|8).toString(16)})+""},saveLists:function(){for(var h=[],c=0;c<f.l.length;c++)h.push(f.l[c].id);localStorage.lists=h},store:function(){localStorage.lists=[f.list_name,false];var h=[],c;for(c in f.tasks){var k=[c,f.tasks[c]].join(f.separator);f.tasks[c]||h.push(k)}localStorage["lists."+f.list_name]=h.join(",")},rollup:function(){if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("compact")<0)bdy.className+=" compact";window.scrollTo(0,0)},rollupQuick:function(){if((bdy=
document.getElementsByTagName("body")[0])&&bdy.className.indexOf("quick")<0)bdy.className+=" quick";if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("compact")<0)bdy.className+=" compact";window.scrollTo(0,0)},add:function(){},touch:function(){f.hLS()&&(localStorage.lastSeen=new Date)},lastSeen:function(){return f.hLS()&&localStorage.lastSeen},hLS:function(){return"localStorage"in window&&window.localStorage!==null},ping:function(){},bkp:function(h){if(h.keyCode==39)f.goN();
else h.keyCode==37&&f.goP()},intercepts:[],queue:[0,1,2,3,4,5,6,7,8,9],journal:function(){},serialize:function(h){return JSON.stringify(h)}},o;for(o in q)f[o]=q[o];return new _Journaller(f)};
_Doneski.prototype.List=function(f,q,o,h){o=Doneski.tag;var c=o("list");c.name_input=o("input",{type:"text",name:"title",placeholder:"Name this list","class":"delayed"});c.appendChild(c.name_input);c.form=o("form",{action:"/task",method:"post","class":"tasklist"});c.appendChild(c.form);c.task_input=o("input",{type:"text","class":"task",placeholder:"Add your first to-do"});c.form.appendChild(c.task_input);c.form.appendChild(o("input",{type:"submit",value:"Add",style:"display:none;"}));c.task_container=
o("tasks",{"class":"active"});c.appendChild(c.task_container);c.completed_container=o("tasks",{"class":"completed"});c.appendChild(c.completed_container);o={name:function(i){localStorage["lists."+c.id+".name"]=i;c.name_input.className="setted";c.task_input.focus();c.updated("name")},nameB:function(i){c.name(i.target.value)},nameK:function(i){i.keyCode==13&&c.name(i.target.value)},formHandler:function(i){i.preventDefault();Doneski.rollup();c.push(c.task_input.value);c.task_input.value="";return false},
push:function(i){(!(l=localStorage.lists)||l.split(",").indexOf(c.id)==-1)&&c.create(c.id);var n=Doneski.gTId();c.addTask(n);i=new Doneski.Task(c,i,n);c.task_container.insertBefore(i,c.task_container.firstChild);i.addEventListener("kill",c.deathWatch,true);i.addEventListener("update",function(){},true)},addTask:function(i){(a=c.items.indexOf(i))==-1&&c.items.push(i)&&c.updated("add")},updated:function(i,n){Doneski.loaded&&c.save();c.task_input.setAttribute("placeholder",c.items.length?"Add another one":
"Add your first to-do");Doneski.sFH();(n=document["create"+(e="Event")]("UI"+e+"s"))["initUI"+e](i||"update",true,true,window,1);n.l_id=c.id;c["dispatch"+e](n)},loadTask:function(i){i=new Doneski.Task(c,false,i);i.completed?c.completed_container.insertBefore(i,c.completed_container.firstChild):c.task_container.insertBefore(i,c.task_container.firstChild);c.items.push(i.id);c.task_input.setAttribute("placeholder","Add another one")},create:function(i){var n=localStorage.lists?localStorage.lists.split(","):
[];n.push(i);localStorage.lists=n},save:function(){(!(l=localStorage.lists)||l.split(",").indexOf(c.id)==-1)&&c.create(c.id);localStorage["lists."+c.id]=c.items.join(",")},deathWatch:function(i){c.removeTask(i.t_id)},removeTask:function(i){(a=c.items.indexOf(i))>-1&&c.items.splice(c.items.indexOf(i),1);c.updated("remove")},focus:function(){c.task_input.focus()},activate:function(){c.className="active";c.nav_item.className="active";c.old_style&&c.setAttribute("style",c.old_style)},deactivate:function(i){c.className=
i||"";c.nav_item.className="";c.old_style=c.getAttribute("style");c.removeAttribute("style")}};for(var k in o)c[k]=o[k];c.form.list=c;c.form.addEventListener("submit",c.formHandler,true);c.name_input.addEventListener("blur",c.nameB,true);c.name_input.addEventListener("keypress",c.nameK,true);c.id=f;c.title=q||"";c.items=[];if(localStorage["lists."+c.id+".name"]){c.name_input.value=localStorage["lists."+c.id+".name"];c.name_input.className="setted"}if(localStorage["lists."+c.id]&&(h=localStorage["lists."+
c.id].split(",")))for(k=0;k<h.length;k++)c.loadTask(h[k]);c.intercepts=[];c.journal=Doneski.journal;c.sync=Doneski.sync;return c=new _Journaller(c)};_Doneski.prototype.ListNav=function(f){var q=Doneski.tag;q=q("list",{"class":"hidden"});q.list=f;return q};
_Doneski.prototype.Task=function(f,q,o){var h=Doneski.tag("task",{});h.list=f;if(o&&localStorage["tasks."+o]){q=localStorage["tasks."+o].split(Doneski.separator);f=q[0];q=q[1]=="true"}else if(typeof q=="string"){f=q;q=false}else{f=q[0];q=q[1]=="true"}h.id=o||Doneski.gTId();o={taskClick:function(){if(!h.nocancel){h.className+=" clicky";h.completed?window.setTimeout(function(){h.uncomplete()},1E3):window.setTimeout(function(){h.complete()},1E3)}h.nocancel=false},taskMove:function(){h.nocancel=true},
save:function(){h.killed?localStorage.removeItem("tasks."+h.id):localStorage["tasks."+h.id]=[h.innerHTML,h.completed].join(Doneski.separator)},complete:function(){h.className="";h.list.completed_container.insertBefore(h,h.list.completed_container.firstChild);h.completed=true;h.updated("complete")},uncomplete:function(){h.list.task_container.insertBefore(h,h.list.task_container.firstChild);h.className="active";h.completed=false;h.updated("uncomplete")},kill:function(){h.killed&&h.updated("kill")},
updated:function(k,i){Doneski.loaded&&h.save();Doneski.sFH();(i=document.createEvent("UIEvents")).initUIEvent(k||"update",true,true,window,1);i.t_id=h.id;h.dispatchEvent(i)},setText:function(k){h.innerHTML=k}};for(var c in o)h[c]=o[c];h.addEventListener("click",h.taskClick,true);h.addEventListener("touchmove",h.taskMove,true);h.addEventListener("touchend",h.taskClick,true);h.completed=q;if(!h.completed)h.className="active";h.intercepts=[];h.journal=Doneski.journal;h.sync=Doneski.sync;h=new _Journaller(h);
h.setText(f);h.save();return h};var _Journaller=function(f,q,o,h,c,k){if(f.intercepts){h=function(){f.journal&&f.journal.call&&f.journal(Array.prototype.slice.call(arguments))};o=function(n,p){if(!f.replaying){p=Array.prototype.slice.call(p);h(f.id,n,p)}return i[n].apply(f,p)};var i=[];for(k=0;k<f.intercepts.length;k++){i[m=f.intercepts[k]]=f[m];(function(n,p){if(p)n[p]=function(){o.apply(n,[p,arguments])}})(f,m)}}window.o_register||(window.o_register={});return window.o_register[f.id]=f};
window.Doneski=new _Doneski;window.applicationCache.addEventListener("updateready",function(){window.applicationCache.swapCache()},true);window.setTimeout("Doneski._init();",0);
