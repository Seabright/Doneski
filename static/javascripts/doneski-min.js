var _Doneski=function(){var g=this;g.linger=1E3;g.list_name="default";g.separator="::";g.tag=function(f,c,i){f=document.createElement(f);if(!i&&typeof c=="string")i=c=undefined;if(c)for(var h in c)f.setAttribute(h,c[h]);if(i)f.innerHTML=i;return f};g.bind=function(f,c){c=c||g;return function(){f.apply(c,arguments)}};g.l=[];g.id="doneski";var p={_init:function(){g.lcon=(gtn=g.gtn)((l="list")+"s")[0];g.ln=gtn(l+"nav")[0];g.tb=t=gtn(tb="toolbar")[0];g.fudge=gtn("content")[0];if((ls="localStorage")in
(w=window)&&w[ls]!==null){g.touch();w.scrollTo(0,35);if(localStorage[l+"s"]){var f=w[ls][l+"s"].split(",");g.rollupQuick();for(var c=0;c<f.length;c++)g.lL(f[c]);(f=w[ls]["last_"+l]?g.find(w[ls]["last_"+l]):g.l[0])||(f=g.l[0]);g.go(f)}else g.newList();g.sFH()}(ael=g.ael)("keyup",g.bkp,true);if(typeof TouchyFeely!="undefined"){g.toucher=new TouchyFeely(document,{mL:10,cscroll:0});ael((a="swipe")+"start",g.swS,true);ael(a+"move",g.swM,true);ael(a+"end",g.swE,true);ael((a="scroll")+"start",g.scS,true);
ael(a+"move",g.scM,true);ael(a+"end",g.scE,true)}(st=w.setTimeout)(function(){g.gtn("body")[0].className+=" loaded"},200);g.dT();g.loaded=true;w.scrollTo(0,0)},ael:function(f,c,i){return document.addEventListener(f,c,i)},gtn:function(f){return document.getElementsByTagName(f)},dT:function(f){try{(f=document).createEvent("TouchEvent")&&(f.body.className+=" touch")}catch(c){}},ns:function(f,c,i,h){c={opacity:0.2,range:100};if(f)for(var j in f)c[j]=f[j];if(!(d=document)[ce="createElement"]("canvas").getContext)return false;
h=(i=d[ce]("canvas")).getContext("2d");i.width=c.width||960;i.height=c.height||30;for(f=0;f<i.width;f++)for(j=0;j<i.height;j++){var k=Math.floor(Math.random()*c.range);h.fillStyle="rgba("+k+","+k+","+k+","+c.opacity+")";h.fillRect(f,j,1,1)}return"url("+i.toDataURL("image/png")+")"},nb:function(f,c,i,h,j,k){if(!(h=document)[ce="createElement"]("canvas").getContext)return false;k=(j=h[ce]("canvas")).getContext("2d");j.width=4;j.height=1;k.fillStyle="rgba(236,0,140,.2)";k.fillRect(0,0,1,1);k.fillRect(3,
0,1,1);return"url("+j.toDataURL("image/png")+")"},cachedTexture:function(f,c,i,h,j,k,q){h&&(w=window)[ls="localStorage"][h="tx."+h]&&(k=w[ls][h]);j={bg:{repeat:"no-repeat",position:"left top"}};if(i)for(q in i)j[q]=i[q];if(!k){k=c(i);w[ls][h]=k}(st=g.styles()).innerHTML+=f+"{"+(b="background-")+"image:"+k+";";for(q in bg=j.bg)st.innerHTML+=b+q+":"+bg[q]+";";st.innerHTML+="}\n";return true},styles:function(){if(g.css)return g.css;g.css=(d=document).createElement("style");d.getElementsByTagName("head")[0].appendChild(g.css);
return g.css},swS:function(){g.swiping=true},swM:function(){},swE:function(f){f.direction=="left"?g.goN():g.goP();g.swiping=false},scS:function(){if((a=(g.scT=g.cL).getAttribute("style")||"").indexOf(w="-webkit-transform:translate3d(")==-1){g.scT.setAttribute("style",a+w+"0px,0px,0px);");g.scS=0}else g.scS=parseInt(a.replace(/.*-webkit-transform:translate3d\((-)?[0-9]{1,5}(px)?,((-)?[0-9]{1,5})(px)?,.*/,"$3"),10);g.scrolling=true},scM:function(f,c){c=(e=g.scS+f.dY)>0?0:e<(d=g.mSc())?d:e;g.scT.setAttribute("style",
g.scT.getAttribute("style").replace(/-webkit-transform:translate3d\(((-)?[0-9]{1,5}(px)?),(-)?[0-9]{1,5}(px)?,/,"-webkit-transform:translate3d($1,"+c+"px,"))},scE:function(){g.scrolling=false},mSc:function(){return 0-g.scT.clientHeight+window.innerHeight},lL:function(f,c,i,h){(i=new Doneski.List(f)).nav_item=h=new Doneski.ListNav(i);i.addEventListener("killed",g.lK,0);g.addList(i.id);c&&(i.className+=c);g.lcon.appendChild(i);g.ln.appendChild(h);g.rN();return i},lK:function(f,c,i){(n=(c=f.target).nav_item).parentNode.removeChild(n);
i=g.removeList(c);g.l.length==0?g.newList():g.go(g.l[i?i-1:0])},removeList:function(f,c){if((c=g.l.indexOf(f))>-1)g.l.splice(c,1);return c},addList:function(f){g.l.push(window.o_register[f]||g.lL(f));g.l.length>1&&g.aCN(document.body,"manylists")},rN:function(){ln=g.ln;if(ln.clientWidth>g.tb.clientWidth*0.9){a="tight";for(o=4;o--;)ln.className=ln.className.replace(a+(o-1),a+o)}},newList:function(f){f=g.lL(g.gLId(),"after");g.go(f)},hCN:function(f,c,i){return f&&(i=f.getAttribute("className")||f.getAttribute("class")||
"").length>0&&(i==c||RegExp("(^|\\s)"+c+"(\\s|$)").test(i))},aCN:function(f,c,i,h){if(f&&!g.hCN(f,c)){h=(i=f.className)+(i.length?" ":"")+c;f.className=h}},rCN:function(f,c){if(f){cls=(f.getAttribute("className")||f.getAttribute("class")||"").replace(RegExp("(^|\\s+)"+c+"(\\s+|$)")," ");f.setAttribute("className",cls)||f.setAttribute("class",cls)}},find:function(f){for(var c=0;c<g.l.length;c++)if(g.l[c].id==f)return g.l[c]},go:function(f){for(var c="",i=0;i<g.l.length;i++)if(g.l[i]!=f)g.l[i].deactivate(c);
else{g.l[i].activate();c="after"}g.cL=f;g.sFH();localStorage.last_list=f.id},sFH:function(){if((s=g.styles())&&s.innerHTML.indexOf("/*fudge heights*/")==-1)g.styles().innerHTML+="\n/*fudge heights*/content,lists list{min-height:"+(window.innerHeight+60)+"px;}";else g.styles().innerHTML.replace("\n/*fudge heights*/content,lists list{[^}]+}","\n/*fudge heights*/content,lists list{min-height:"+(window.innerHeight+60)+"px;}")},goN:function(){var f=g.l.indexOf(g.cL)+1;f>=g.l.length?g.newList():g.go(g.l[f])},
goP:function(){var f=g.l.indexOf(g.cL)-1;f>=0&&g.go(g.l[f])},gTId:function(){return"t_"+g.gUU()},gLId:function(){return"l_"+g.gUU()},gUU:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var c=Math.random()*16|0;return(f=="x"?c:c&3|8).toString(16)})+""},rollup:function(){g.aCN(document.body,"compact");window.scrollTo(0,0)},rollupQuick:function(){g.aCN(document.body,"quick");g.aCN(document.body,"compact");window.scrollTo(0,0)},add:function(){},touch:function(){g.hLS()&&
(localStorage.lastSeen=new Date)},lastSeen:function(){return g.hLS()&&localStorage.lastSeen},hLS:function(){return"localStorage"in window&&window.localStorage!==null},ping:function(){},bkp:function(f){if(f.keyCode==39)g.goN();else f.keyCode==37&&g.goP()},intercepts:[],queue:[0,1,2,3,4,5,6,7,8,9],journal:function(){},serialize:function(f){return JSON.stringify(f)}},o;for(o in p)g[o]=p[o];return new _Journaller(g)};
_Doneski.prototype.List=function(g,p,o,f){o=Doneski.tag;var c=o("list");c.name_input=o("input",{type:"text",name:"title",placeholder:"Name this list","class":"delayed"});c.appendChild(c.name_input);c.form=o("form",{action:"/task",method:"post","class":"tasklist"});c.appendChild(c.form);c.task_input=o("input",{type:"text","class":"task",placeholder:"Add your first to-do"});c.form.appendChild(c.task_input);c.form.appendChild(o("input",{type:"submit",value:"Add",style:"display:none;"}));c.task_container=
o("tasks",{"class":"active"});c.appendChild(c.task_container);c.completed_container=o("tasks",{"class":"completed"});c.appendChild(c.completed_container);o={name:function(h){if(h.length){localStorage["lists."+c.id+".name"]=h;c.nm=h;c.name_input.value=h;c.convertNameBox();c.task_input.focus();c.updated("name")}},convertNameBox:function(){if(!c.converted){c.nm_e=document.createElement("name");c.nm_e.innerHTML="<span>"+c.nm+"</span>";c.nm_e.addEventListener("click",c.name_click,0);c.replaceChild(c.nm_e,
c.name_input);c.converted=1}},rename:function(){if(c.converted){c.replaceChild(c.name_input,c.nm_e);c.name_input.focus();c.converted=0}},kill:function(h,j,k){for(h in c.tasks)if((j=c.tasks[h])&&j.kill)j.kill();localStorage.removeItem("lists."+c.id);localStorage.removeItem("lists."+c.id+".name");k=localStorage.lists?localStorage.lists.split(","):[];if((h=k.indexOf(c.id))>-1)k.splice(h,1);localStorage.lists=k;c.parentNode.removeChild(c);c.updated("killed")},name_click:function(h,j,k){j=c.nm_e;k=j.menu||
(j.menu=c.newMenu());if(j.popped){Doneski.rCN(j,"popped");k.setAttribute("style","height:0;");setTimeout(function(){k.style.display="none"},300);j.popped=false}else{j.style.webkitTransition="background-color 2s linear;";Doneski.aCN(j,"popped");k.setAttribute("style","height:0;");setTimeout(function(){k.style.height="70px"},0);j.popped=true}h.preventDefault();return false},newMenu:function(h,j,k,q){h=document.createElement("menu");h.appendChild(j=document.createElement("items"));j.appendChild(k=document.createElement("item"));
k.addEventListener("click",c.rename,1);k.className="rename";k.innerHTML="Rename";j.appendChild(q=document.createElement("item"));q.addEventListener("click",c.kill,1);q.className="delete";q.innerHTML="Delete";h.style.display="none";c.nm_e.appendChild(h);return h},nameB:function(h){c.name(h.target.value)},nameK:function(h){h.keyCode==13&&c.name(h.target.value)},formHandler:function(h){h.preventDefault();Doneski.rollup();c.push(c.task_input.value);c.task_input.value="";return false},tasks:[],push:function(h){(!(l=
localStorage.lists)||l.split(",").indexOf(c.id)==-1)&&c.create(c.id);var j=Doneski.gTId();c.addTask(j);h=new Doneski.Task(c,h,j);c.tasks.push(h);c.task_container.insertBefore(h,c.task_container.firstChild);h.addEventListener("kill",c.deathWatch,true);h.addEventListener("update",function(){},true)},addTask:function(h){(a=c.items.indexOf(h))==-1&&c.items.push(h)&&c.updated("add")},updated:function(h,j){Doneski.loaded&&c.save();c.task_input.setAttribute("placeholder",c.items.length?"Add another one":
"Add your first to-do");Doneski.sFH();(j=document["create"+(e="Event")]("UI"+e+"s"))["initUI"+e](h||"update",true,true,window,1);j.l_id=c.id;c["dispatch"+e](j);c.items.length>1&&Doneski.aCN(document.body,"manyitems")},loadTask:function(h){h=new Doneski.Task(c,false,h);h.completed?c.completed_container.insertBefore(h,c.completed_container.firstChild):c.task_container.insertBefore(h,c.task_container.firstChild);c.items.push(h.id);c.task_input.setAttribute("placeholder","Add another one");c.items.length>
1&&Doneski.aCN(document.body,"manyitems")},create:function(h){var j=localStorage.lists?localStorage.lists.split(","):[];j.push(h);localStorage.lists=j},save:function(){(!(l=localStorage.lists)||l.split(",").indexOf(c.id)==-1)&&c.create(c.id);localStorage["lists."+c.id]=c.items.join(",")},deathWatch:function(h){c.removeTask(h.t_id)},removeTask:function(h){(a=c.items.indexOf(h))>-1&&c.items.splice(c.items.indexOf(h),1);c.updated("remove")},focus:function(){c.task_input.focus()},activate:function(){c.className=
"active";c.nav_item.className="active";c.old_style&&c.setAttribute("style",c.old_style)},deactivate:function(h){c.className=h||"";c.nav_item.className="";c.old_style=c.getAttribute("style");c.removeAttribute("style")}};for(var i in o)c[i]=o[i];c.form.list=c;c.form.addEventListener("submit",c.formHandler,true);c.name_input.addEventListener("blur",c.nameB,true);c.name_input.addEventListener("keypress",c.nameK,true);c.id=g;c.title=p||"";c.items=[];localStorage["lists."+c.id+".name"]&&c.name(localStorage["lists."+
c.id+".name"]);if(localStorage["lists."+c.id]&&(f=localStorage["lists."+c.id].split(",")))for(i=0;i<f.length;i++)c.loadTask(f[i]);c.intercepts=[];c.journal=Doneski.journal;c.sync=Doneski.sync;return c=new _Journaller(c)};_Doneski.prototype.ListNav=function(g){var p=Doneski.tag,o=p("list",{"class":"hidden"});o.list=g;o.addEventListener("click",function(){Doneski.go(o.list)},true);return o};
_Doneski.prototype.Task=function(g,p,o){var f=Doneski.tag("task",{});f.list=g;if(o&&localStorage["tasks."+o]){p=localStorage["tasks."+o].split(Doneski.separator);g=p[0];p=p[1]=="true"}else if(typeof p=="string"){g=p;p=false}else{g=p[0];p=p[1]=="true"}f.id=o||Doneski.gTId();o={taskClick:function(){if(!f.nocancel&&!Doneski.swiping&&!Doneski.scrolling){f.className+=" clicky";f.completed?window.setTimeout(function(){f.uncomplete()},1E3):window.setTimeout(function(){f.complete()},1E3)}f.nocancel=false},
taskMove:function(){f.nocancel=true},save:function(){f.killed?localStorage.removeItem("tasks."+f.id):localStorage["tasks."+f.id]=[f.innerHTML,f.completed].join(Doneski.separator);return 1},complete:function(){f.className="";f.list.completed_container.insertBefore(f,f.list.completed_container.firstChild);f.completed=true;f.updated("complete")},uncomplete:function(){f.list.task_container.insertBefore(f,f.list.task_container.firstChild);f.className="active";f.completed=false;f.updated("uncomplete")},
kill:function(){(f.killed=1)&&f.save()&&f.updated("kill")},updated:function(i,h){Doneski.loaded&&f.save();Doneski.sFH();(h=document.createEvent("UIEvents")).initUIEvent(i||"update",true,true,window,1);h.t_id=f.id;f.dispatchEvent(h)},setText:function(i){f.innerHTML=i}};for(var c in o)f[c]=o[c];f.addEventListener("click",f.taskClick,false);f.addEventListener("touchmove",f.taskMove,true);f.addEventListener("touchend",f.taskClick,true);f.completed=p;if(!f.completed)f.className="active";f.intercepts=[];
f.journal=Doneski.journal;f.sync=Doneski.sync;f=new _Journaller(f);f.setText(g);console.log("wtf?");if(!f.del){f.del=document.createElement("delete");f.del.addEventListener("click",f.kill,1);f.appendChild(f.del)}f.save();return f};
var _Journaller=function(g,p,o,f,c,i){if(g.intercepts){f=function(){g.journal&&g.journal.call&&g.journal(Array.prototype.slice.call(arguments))};o=function(j,k){if(!g.replaying){k=Array.prototype.slice.call(k);f(g.id,j,k)}return h[j].apply(g,k)};var h=[];for(i=0;i<g.intercepts.length;i++){h[m=g.intercepts[i]]=g[m];(function(j,k){if(k)j[k]=function(){o.apply(j,[k,arguments])}})(g,m)}}window.o_register||(window.o_register={});return window.o_register[g.id]=g};window.Doneski=new _Doneski;
window.applicationCache.addEventListener("updateready",function(){window.applicationCache.swapCache()},true);window.setTimeout("Doneski._init();",0);
