var _Doneski=function(){var c=this;c.linger=1E3;c.list_name="default";c.separator="::";c.tag=function(b,c,g){b=document.createElement(b);!g&&typeof c=="string"&&(g=c=void 0);if(c)for(var e in c)b.setAttribute(e,c[e]);if(g)b.innerHTML=g;return b};c.bind=function(b,d){d=d||c;return function(){b.apply(d,arguments)}};c.lists=[];var f={_init:function(){c.lists_container=(gtn=c.gtn)("lists")[0];c.list_nav=gtn("listnav")[0];c.toolbar=t=gtn("toolbar")[0];c.fudge=gtn("content")[0];if("localStorage"in(w=window)&&
w.localStorage!==null){c.touch();w.scrollTo(0,35);if(localStorage.lists){var b=localStorage.lists.split(",");c.rollup();for(var d=0;d<b.length;d++)c.loadList(b[d]);(b=localStorage.last_list?c.find(localStorage.last_list):c.lists[0])||(b=c.lists[0]);c.go(b)}else c.newList();c.setFudgeHeight()}(ael=c.ael)("keyup",c.bkp,!0);if(typeof TouchyFeely!="undefined")c.toucher=new TouchyFeely(document,{cscroll:0}),ael((a="swipe")+"start",c.swS,!0),ael(a+"move",c.swM,!0),ael(a+"end",c.swE,!0),ael((a="scroll")+
"start",c.scS,!0),ael(a+"move",c.scM,!0);(st=w.setTimeout)(function(){c.gtn("body")[0].className+=" loaded"},500);st(function(){c.noisify(t,{opacity:0.3,range:50},"tb")},0);st(function(){c.notebookify(gtn("content")[0])},0);w.scrollTo(0,0);c.loaded=!0},ael:function(b,c,g){return document.body.addEventListener(b,c,g)},gtn:function(b){return document.getElementsByTagName(b)},noisify:function(b,c,g,e,f){g&&localStorage[g="ns"+g]&&(f=localStorage[g]);if(!f){e={opacity:0.2,range:100};if(c)for(var h in c)e[h]=
c[h];if(!document.createElement("canvas").getContext)return!1;c=(canvas=document.createElement("canvas")).getContext("2d");canvas.width=b.clientWidth;canvas.height=b.clientHeight;for(f=0;f<canvas.width;f++)for(h=0;h<canvas.height;h++){var i=Math.floor(Math.random()*e.range);c.fillStyle="rgba("+i+","+i+","+i+","+e.opacity+")";c.fillRect(f,h,1,1)}f="url("+canvas.toDataURL("image/png")+")";localStorage[g]=f}b.style.backgroundImage=f;return!0},notebookify:function(b,c,g){g=20;if(!(c=localStorage.bg)){if(!document.createElement("canvas").getContext)return!1;
var c=document.createElement("canvas"),e=c.getContext("2d");c.width=4;c.height=1;e.fillStyle="rgba(236,0,140,.2)";e.fillRect(0,0,1,1);e.fillRect(3,0,1,1);c="url("+c.toDataURL("image/png")+")";localStorage.bg=c}b.style.backgroundImage=c;b.style.backgroundRepeat="repeat-y";b.style.backgroundPosition=g+"px top";return!0},swS:function(){},swE:function(b){b.direction=="left"?c.goNext():c.goPrevious()},swM:function(){},scM:function(b){if((top=c.scrollstart-b.vD)<0)top=0;if(top>(max=c.maxScroll()))top=max;
window.scrollTo(0,top)},scS:function(){c.scrollstart=window.pageYOffset||window.scrollY},maxScroll:function(){return document.body.clientHeight-window.innerHeight},loadList:function(b){var b=new Doneski.List(b),d=new Doneski.ListNav(b);b.nav_item=d;c.lists.push(b);c.lists_container.appendChild(b);c.list_nav.appendChild(d);c.rejig_nav();return b},rejig_nav:function(){ln=c.list_nav;if(ln.clientWidth>c.toolbar.clientWidth*0.9){a="tight";for(e=4;e--;)ln.className=ln.className.replace(a+(e-1),a+e)}},newList:function(){var b=
c.loadList(c.generateListId());b.className="after";window.setTimeout(function(){c.go(b)},200)},find:function(b){for(var d=0;d<c.lists.length;d++)if(c.lists[d].id==b)return c.lists[d]},go:function(b){for(var d="",g=0;g<c.lists.length;g++)c.lists[g]!=b?c.lists[g].deactivate(d):(c.lists[g].activate(),c.fudge.style.height=b.clientHeight,d="after");c.current_list=b;c.setFudgeHeight();localStorage.last_list=b.id},setFudgeHeight:function(){if(cl=c.current_list)c.fudge.style.height=((cL=cl.clientHeight+50)>
(wh=window.innerHeight)?cL:wh)+"px",window.setTimeout(function(){c.setFudgeHeight()},200)},goNext:function(){var b=c.lists.indexOf(c.current_list)+1;b>=c.lists.length?c.newList():c.go(c.lists[b])},goPrevious:function(){var b=c.lists.indexOf(c.current_list)-1;b>=0&&c.go(c.lists[b])},generateTaskId:function(){return"t_"+c.generateUUID()},generateListId:function(){return"l_"+c.generateUUID()},generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=Math.random()*
16|0;return(b=="x"?c:c&3|8).toString(16)})+""},saveLists:function(){for(var b=[],d=0;d<c.lists.length;d++)b.push(c.lists[d].id);localStorage.lists=b},store:function(){localStorage.lists=[c.list_name,!1];var b=[],d;for(d in c.tasks){var g=[d,c.tasks[d]].join(c.separator);c.tasks[d]||b.push(g)}localStorage["lists."+c.list_name]=b.join(",")},rollup:function(){if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("compact")<0)bdy.className+=" compact";window.scrollTo(0,0)},rollupQuick:function(){if((bdy=
document.getElementsByTagName("body")[0])&&bdy.className.indexOf("quick")<0)bdy.className+=" quick";if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("compact")<0)bdy.className+=" compact";window.scrollTo(0,0)},add:function(){},touch:function(){c.hasLocalStorage()&&(localStorage.lastSeen=new Date)},lastSeen:function(){return c.hasLocalStorage()&&localStorage.lastSeen},hasLocalStorage:function(){return"localStorage"in window&&window.localStorage!==null},ping:function(){console.log("Yeah yeah.",
c)},bkp:function(b){b.keyCode==39?c.goNext():b.keyCode==37&&c.goPrevious()},swipe:function(){},intercepts:[],intercept:function(b){if(b.intercepts)for(var c=0;c<b.intercepts.length;c++){var g=b[b.intercepts[c]];g&&console.log(g.constructor)}},perform:function(){var b=Array.prototype.slice.call(arguments),d=b.shift(),g=b.shift();c.journal(d,g,b);return d[g].apply(d,b)},journal:function(){console.log(c.serialize(Array.prototype.slice.call(arguments)))},serialize:function(b){return JSON.stringify(b)}},
e;for(e in f)c[e]=f[e]};
_Doneski.prototype.List=function(c,f){var e=Doneski.tag,b=e("list");b.name_input=e("input",{type:"text",name:"title",placeholder:"Name this list","class":"delayed"});b.appendChild(b.name_input);b.form=e("form",{action:"/task",method:"post","class":"tasklist"});b.appendChild(b.form);b.task_input=e("input",{type:"text","class":"task",placeholder:"Add your first to-do"});b.form.appendChild(b.task_input);b.form.appendChild(e("button",{"class":"add"},"+"));b.form.appendChild(e("input",{type:"submit",value:"Add",
style:"display:none;"}));b.task_container=e("tasks",{"class":"active"});b.appendChild(b.task_container);b.completed_container=e("tasks",{"class":"completed"});b.appendChild(b.completed_container);var e={name:function(c){localStorage["lists."+b.id+".name"]=c;b.name_input.className="setted";b.task_input.focus()},nameB:function(c){b.name(c.target.value)},nameK:function(c){c.keyCode==13&&b.name(c.target.value)},formHandler:function(c){c.preventDefault();Doneski.rollup();b.push(b.task_input.value);b.task_input.value=
"";return!1},taskMove:function(b){b.target.nocancel=!0},push:function(c){c=new Doneski.Task(b,c);b.task_container.insertBefore(c,b.task_container.firstChild);b.items.push(c.id);Doneski.loaded&&b.save();b.task_input.setAttribute("placeholder","Add another one");Doneski.setFudgeHeight()},loadTask:function(c){c=new Doneski.Task(b,!1,c);c.completed?b.completed_container.insertBefore(c,b.completed_container.firstChild):b.task_container.insertBefore(c,b.task_container.firstChild);b.items.push(c.id);b.task_input.setAttribute("placeholder",
"Add another one")},save:function(){if(!localStorage.lists||localStorage.lists.split(",").indexOf(b.id)==-1){var c=localStorage.lists?localStorage.lists.split(","):[];c.push(b.id);localStorage.lists=c}localStorage["lists."+b.id]=b.items.join(",")},remove:function(c){c.className=c.className.replace("active","");window.setTimeout(function(){c.parentNode.removeChild(c)},200);b.items[c.innerHTML]=!0;b.save()},focus:function(){b.task_input.focus()},activate:function(){b.className="active";b.nav_item.className=
"active"},deactivate:function(c){b.className=c||"";b.nav_item.className=""}},d;for(d in e)b[d]=e[d];b.form.list=b;b.form.addEventListener("submit",b.formHandler,!0);b.name_input.addEventListener("blur",b.nameB,!0);b.name_input.addEventListener("keypress",b.nameK,!0);b.id=c;b.title=f||"";b.items=[];if(localStorage["lists."+b.id+".name"])b.name_input.value=localStorage["lists."+b.id+".name"],b.name_input.className="setted";if(localStorage["lists."+b.id]){e=localStorage["lists."+b.id].split(",");for(d=
0;d<e.length;d++)b.loadTask(e[d])}return b};_Doneski.prototype.ListNav=function(c){var f=Doneski.tag,f=f("list",{"class":"hidden"});f.list=c;return f};
_Doneski.prototype.Task=function(c,f,e){var b=Doneski.tag("task",{});b.list=c;e&&localStorage["tasks."+e]?(f=localStorage["tasks."+e].split(Doneski.separator),c=f[0],f=f[1]=="true",b.id=e):(typeof f=="string"?(c=f,f=!1):(c=f[0],f=f[1]=="true"),b.id=Doneski.generateTaskId());b.innerHTML=c;var e={taskClick:function(){!b.nocancel&&b.clickable&&(b.className+=" clicky",b.completed?window.setTimeout(function(){b.uncomplete()},1E3):window.setTimeout(function(){b.complete()},1E3));b.nocancel=!1},taskMove:function(){b.nocancel=
!0},save:function(){localStorage["tasks."+b.id]=[b.innerHTML,b.completed].join(Doneski.separator)},complete:function(){console.log("complete");b.className="";b.list.completed_container.insertBefore(b,b.list.completed_container.firstChild);b.completed=!0;b.save()},uncomplete:function(){console.log("uncomplete");b.list.task_container.insertBefore(b,b.list.task_container.firstChild);b.className="active";b.completed=!1;b.save()},focus:function(){}},d;for(d in e)b[d]=e[d];b.clickable=!0;b.addEventListener("click",
b.taskClick,!0);b.addEventListener("touchmove",b.taskMove,!0);b.addEventListener("touchend",b.taskClick,!0);b.completed=f;if(!b.completed)b.className="active";b.save();return b};window.Doneski=new _Doneski;window.applicationCache.addEventListener("updateready",function(){window.applicationCache.swapCache()},!0);window.setTimeout("Doneski._init();",0);
