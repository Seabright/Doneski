var _Doneski=function(){var b=this;b.linger=1E3;b.list_name="default";b.separator="::";b.tag=function(a,b,c){a=document.createElement(a);!c&&typeof b=="string"&&(c=b=void 0);if(b)for(var g in b)a.setAttribute(g,b[g]);if(c)a.innerHTML=c;return a};b.bind=function(a,d){d=d||b;return function(){a.apply(d,arguments)}};b.lists=[];var e={_init:function(){b.lists_container=document.body.getElementsByTagName("lists")[0];b.lists_container.getElementsByTagName("list");if("localStorage"in window&&window.localStorage!==
null)if(b.touch(),window.scrollTo(0,35),localStorage["doneski.lists"]){var a=localStorage["doneski.lists"].split(",");b.rollup();for(var d=0;d<a.length;d++)b.loadList(a[d]);b.lists[0].focus()}else b.newList();else console.log("no LS",b._hasLS);window.setTimeout("document.getElementsByTagName('body')[0].className += ' loaded';",500);b.loaded=!0},loadList:function(a){a=new Doneski.List(a);b.lists.push(a);b.lists_container.appendChild(a);return a},newList:function(){b.generateListId();b.loadList(b.last_id);
b.go(b.lists[b.lists.length-1])},go:function(a){for(var d=0;d<b.lists.length;d++)b.lists[d].deactivate();a.activate()},generateListId:function(){b.last_id="l_xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0;return(a=="x"?b:b&3|8).toString(16)});return b.last_id},saveLists:function(){for(var a=[],c=0;c<b.lists.length;c++)a.push(b.lists[c].id);localStorage["doneski.lists"]=a},store:function(){localStorage["doneski.lists"]=[b.list_name,!1];var a=[],c;for(c in b.tasks){var e=
[c,b.tasks[c]].join(b.separator);b.tasks[c]||a.push(e)}localStorage["doneski.lists."+b.list_name]=a.join(",")},rollup:function(){if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("compact")<0)bdy.className+=" compact";window.scrollTo(0,0)},rollupQuick:function(){if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("quick")<0)bdy.className+=" quick";if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("compact")<0)bdy.className+=" compact";
window.scrollTo(0,0)},add:function(){},touch:function(){b.hasLocalStorage()&&(localStorage["doneski.lastSeen"]=new Date)},lastSeen:function(){return b.hasLocalStorage()&&localStorage["doneski.lastSeen"]},hasLocalStorage:function(){return"localStorage"in window&&window.localStorage!==null},ping:function(){console.log("Yeah yeah.",b)},bkp:function(a){a.keyCode==39&&b.newList()}},c;for(c in e)b[c]=b.bind(e[c])};
_Doneski.prototype.List=function(b,e){var c=Doneski.tag,a=c("list");a.name_input=c("input",{type:"text",name:"title",placeholder:"Name this list","class":"delayed"});a.appendChild(a.name_input);a.form=c("form",{action:"/task",method:"post","class":"tasklist"});a.appendChild(a.form);a.task_input=c("input",{type:"text","class":"task",placeholder:"Add your first to-do"});a.form.appendChild(a.task_input);a.form.appendChild(c("button",{"class":"add"},"+"));a.form.appendChild(c("input",{type:"submit",value:"Add",
style:"display:none;"}));a.task_container=c("tasks",{"class":"active"});a.appendChild(a.task_container);a.appendChild(c("tasks",{"class":"completed"}));var c={name:function(b){localStorage["doneski.lists."+a.id+".name"]=b;a.name_input.className="setted";a.task_input.focus()},nameB:function(b){a.name(b.target.value)},nameK:function(b){b.keyCode==13&&a.name(b.target.value)},formHandler:function(b){b.preventDefault();Doneski.rollup();a.push(a.task_input.value);a.task_input.value="";return!1},taskClick:function(b){var c=
b.target;!c.nocancel&&c.clickable&&(c.className+=" clicky",window.setTimeout(function(){a.remove(c)},1E3));c.nocancel=!1},taskMove:function(a){a.target.nocancel=!0},push:function(b){var c=document.createElement("task"),d;typeof b=="string"?(d=b,b=!1):(d=b[0],b=b[1]=="true");c.innerHTML=d;c.clickable=!0;c.addEventListener("click",a.taskClick,!0);c.addEventListener("touchmove",a.taskMove,!0);c.addEventListener("touchend",a.taskClick,!0);a.task_container.insertBefore(c,a.task_container.firstChild);b||
window.setTimeout(function(){c.className="active"},1);a.items[d]=b;Doneski.loaded&&a.save();a.task_input.setAttribute("placeholder","Add another one")},save:function(){if(!localStorage["doneski.lists"]||localStorage["doneski.lists"].split(",").indexOf(a.id)==-1){var b=localStorage["doneski.lists"]?localStorage["doneski.lists"].split(","):[];b.push(a.id);localStorage["doneski.lists"]=b}var b=[],c;for(c in a.items){var d=[c,a.items[c]].join(Doneski.separator);a.items[c]||b.push(d)}localStorage["doneski.lists."+
a.id]=b.join(",")},remove:function(b){b.className=b.className.replace("active","");window.setTimeout(function(){b.parentNode.removeChild(b)},200);a.items[b.innerHTML]=!0;a.save()},focus:function(){a.task_input.focus()},activate:function(){a.className="active";a.task_input.focus()},deactivate:function(){a.className=""}},d;for(d in c)a[d]=Doneski.bind(c[d],a);a.form.list=a;a.form.addEventListener("submit",a.formHandler,!0);a.name_input.addEventListener("blur",a.nameB,!0);a.name_input.addEventListener("keypress",
a.nameK,!0);a.id=b;a.title=e||"";a.items={};if(localStorage["doneski.lists."+a.id+".name"])a.name_input.value=localStorage["doneski.lists."+a.id+".name"],a.name_input.className="setted";if(localStorage["doneski.lists."+a.id]){var c=localStorage["doneski.lists."+a.id].split(","),f="";for(d=0;d<c.length;d++)f=c[d].split(Doneski.separator),a.push(f)}return a};
_Doneski.prototype.Task=function(b){b=function(b,a,d){b=document.creatElement(b);!d&&typeof a=="string"&&(d=a=void 0);if(a)for(var e in a)b[e]=a[e];if(d)b.innerHTML=d;return b}("task",{"class":"active"},b);b.events={click:function(b){var a=b.target;!a.nocancel&&a.clickable&&(a.className+=" clicky",window.setTimeout(function(){a.events.destroy()},_Doneski.linger));a.nocancel=!1},move:function(b){b.target.nocancel=!0}};el.addEventListener("click",b.events.click,!0);el.addEventListener("touchend",doneski.taskClick,
!0);el.addEventListener("touchmove",list.taskMove,!0);for(var e in core)list[e]=_Doneski.bind(core[e],b);b.id=id;list.title=title||"";list.items=[];if(!localStorage["doneski.lists"]||localStorage["doneski.lists"].split(",").indexOf(list.id)==-1)(localStorage["doneski.lists"]?localStorage["doneski.lists"].split(","):[]).push(list.id);return list};window.Doneski=new _Doneski;window.setTimeout("Doneski._init();",0);
