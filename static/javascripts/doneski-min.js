var _Doneski=function(){var g=this;g.linger=1E3;g.list_name="default";g.separator="::";g.tag=function(f,g,k){f=document.createElement(f);!k&&typeof g=="string"&&(k=g=void 0);if(g)for(var h in g)f.setAttribute(h,g[h]);if(k)f.innerHTML=k;return f};g.bind=function(f,p){p=p||g;return function(){f.apply(p,arguments)}};g.l=[];var o={_init:function(){g.lcon=(gtn=g.gtn)((l="list")+"s")[0];g.ln=gtn(l+"nav")[0];g.tb=t=gtn(tb="toolbar")[0];g.fudge=gtn("content")[0];if((ls="localStorage")in(w=window)&&w[ls]!==
null){g.touch();g.currentJournal=parseInt(w[ls]["journal.current"]||1,10);g.lastSync=parseInt(w[ls]["journal.lastsync"]||0,10);w.scrollTo(0,35);if(localStorage[l+"s"]){var f=w[ls][l+"s"].split(",");g.rollup();for(var p=0;p<f.length;p++)g.lL(f[p]);(f=w[ls]["last_"+l]?g.find(w[ls]["last_"+l]):g.l[0])||(f=g.l[0]);g.go(f)}else g.newList();console.log("got",g.currentJournal,g.lastSync);g.sFH()}(ael=g.ael)("keyup",g.bkp,!0);if(typeof TouchyFeely!="undefined")g.toucher=new TouchyFeely(document,{cscroll:0}),
ael((a="swipe")+"start",g.swS,!0),ael(a+"move",g.swM,!0),ael(a+"end",g.swE,!0),ael((a="scroll")+"start",g.scS,!0),ael(a+"move",g.scM,!0);(st=w.setTimeout)(function(){g.gtn("body")[0].className+=" loaded"},500);st(function(){g.cachedTexture(tb,g.ns,{opacity:0.3,range:50},tb)},0);st(function(){g.cachedTexture("body "+l+"s "+l,g.nb,{bg:{position:"20px top",repeat:"repeat-y"}},"nb")},0);st(function(){g.cachedTexture("body header",g.nb,{bg:{position:"20px top",repeat:"repeat-y"}},"nb")},0);w.scrollTo(0,
0);st(function(){g.sync()},1E3);g.loaded=!0},ael:function(f,g,k){return document.addEventListener(f,g,k)},gtn:function(f){return document.getElementsByTagName(f)},ns:function(f,g,k,h){g={opacity:0.2,range:100};if(f)for(var o in f)g[o]=f[o];if(!(d=document)[ce="createElement"]("canvas").getContext)return!1;h=(k=d[ce]("canvas")).getContext("2d");k.width=g.width||960;k.height=g.height||30;for(f=0;f<k.width;f++)for(o=0;o<k.height;o++){var q=Math.floor(Math.random()*g.range);h.fillStyle="rgba("+q+","+
q+","+q+","+g.opacity+")";h.fillRect(f,o,1,1)}return"url("+k.toDataURL("image/png")+")"},nb:function(f,g,k,h,o,q){if(!(h=document)[ce="createElement"]("canvas").getContext)return!1;q=(o=h[ce]("canvas")).getContext("2d");o.width=4;o.height=1;q.fillStyle="rgba(236,0,140,.2)";q.fillRect(0,0,1,1);q.fillRect(3,0,1,1);return"url("+o.toDataURL("image/png")+")"},cachedTexture:function(f,p,k,h,o,q,r){h&&(w=window)[ls="localStorage"][h="tx."+h]&&(q=w[ls][h]);o={bg:{repeat:"no-repeat",position:"left top"}};
if(k)for(r in k)o[r]=k[r];q||(q=p(k),w[ls][h]=q);(st=g.styles()).innerHTML+=f+"{"+(b="background-")+"image:"+q+";";for(r in bg=o.bg)st.innerHTML+=b+r+":"+bg[r]+";";st.innerHTML+="}\n";return!0},styles:function(){if(g.css)return g.css;g.css=(d=document).createElement("style");d.getElementsByTagName("head")[0].appendChild(g.css);return g.css},swS:function(){if((a=(g.swT=g.cL)["get"+(a="Attribute")]("style")||"").indexOf(w="-webkit-transform:translate3d(")==-1)g.swT["set"+a]("style",a+w+"0px,0px,0px);")},
swM:function(f){g.swT["set"+(a="Attribute")]("style",g.swT["get"+a]("style").replace(/-webkit-transform:translate3d\((-)?[0-9]{1,5}(px)?,/,"-webkit-transform:translate3d("+f.dX+"px,"))},swE:function(f){var h=g.swT;window.setTimeout(function(){h.setAttribute("style","")},100);f.direction=="left"?g.goN():g.goP()},scS:function(){(a=(g.scT=g.cL).getAttribute("style")||"").indexOf(w="-webkit-transform:translate3d(")==-1?(g.scT.setAttribute("style",a+w+"0px,0px,0px);"),g.scS=0):g.scS=parseInt(a.replace(/.*-webkit-transform:translate3d\((-)?[0-9]{1,5}(px)?,((-)?[0-9]{1,5})(px)?,.*/,
"$3"),10)},scM:function(f,h){h=(e=g.scS+f.dY)>0?0:e<(d=g.mSc())?d:e;g.scT.setAttribute("style",g.scT.getAttribute("style").replace(/-webkit-transform:translate3d\(((-)?[0-9]{1,5}(px)?),(-)?[0-9]{1,5}(px)?,/,"-webkit-transform:translate3d($1,"+h+"px,"))},mSc:function(){return 0-g.scT.clientHeight+window.innerHeight},lL:function(f,h,k,o){(k=new Doneski.List(f)).nav_item=o=new Doneski.ListNav(k);g.l.push(k);h&&(k.className+=h);g.lcon.appendChild(k);g.ln.appendChild(o);g.rN();return k},rN:function(){ln=
g.ln;if(ln.clientWidth>g.tb.clientWidth*0.9){a="tight";for(h=4;h--;)ln.className=ln.className.replace(a+(h-1),a+h)}},newList:function(){var f=g.lL(g.gLId(),"after");g.go(f)},find:function(f){for(var h=0;h<g.l.length;h++)if(g.l[h].id==f)return g.l[h]},go:function(f){for(var h="",k=0;k<g.l.length;k++)g.l[k]!=f?g.l[k].deactivate(h):(g.l[k].activate(),h="after");g.cL=f;g.sFH();localStorage.last_list=f.id},sFH:function(f){f==!1||(f=!0);if(cl=g.cL)cl.style.height="",g.fudge.style.height=((cL=cl.clientHeight)>
(wh=window.innerHeight)?cL:wh)+"px",cl.style.height=cL>wh?"":wh+"px",f&&window.setTimeout(function(){g.sFH(!1)},200)},goN:function(){var f=g.l.indexOf(g.cL)+1;f>=g.l.length?g.newList():g.go(g.l[f])},goP:function(){var f=g.l.indexOf(g.cL)-1;f>=0&&g.go(g.l[f])},gTId:function(){return"t_"+g.gUU()},gLId:function(){return"l_"+g.gUU()},gUU:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var g=Math.random()*16|0;return(f=="x"?g:g&3|8).toString(16)})+""},saveLists:function(){for(var f=
[],h=0;h<g.l.length;h++)f.push(g.l[h].id);localStorage.lists=f},store:function(){localStorage.lists=[g.list_name,!1];var f=[],h;for(h in g.tasks){var k=[h,g.tasks[h]].join(g.separator);g.tasks[h]||f.push(k)}localStorage["lists."+g.list_name]=f.join(",")},rollup:function(){if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("compact")<0)bdy.className+=" compact";window.scrollTo(0,0)},rollupQuick:function(){if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("quick")<
0)bdy.className+=" quick";if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("compact")<0)bdy.className+=" compact";window.scrollTo(0,0)},add:function(){},touch:function(){g.hLS()&&(localStorage.lastSeen=new Date)},lastSeen:function(){return g.hLS()&&localStorage.lastSeen},hLS:function(){return"localStorage"in window&&window.localStorage!==null},ping:function(){},bkp:function(f){f.keyCode==39?g.goN():f.keyCode==37&&g.goP()},intercepts:[],queue:[0,1,2,3,4,5,6,7,8,9],newJournal:function(){(l=
localStorage)[(j="journal.")+"unsynced"]||((l=localStorage)[(j="journal.")+"unsynced"]="");if(g[c="currentJournal"])(l=localStorage)[(j="journal.")+"unsynced"]+=g[c]+",";g[c]=g[c]?g[c]+1:1;console.log("set current journal to:",g[c]);l[j+"current"]=g[c]},journal:function(){if(g.loaded)(a=Array.prototype.slice.call(arguments)[0]).unshift((new Date).getTime()+"-"+(d=g.queue.shift())),g.queue.push(g.queue[g.queue.length-1]+1),cur=localStorage[b="journal."+g.currentJournal]||"[]",c=JSON.parse(cur),c.push(a),
localStorage[b]=g.serialize(c),g.needsSync=!0},sync:function(f,h,k){if(g.loaded&&!g.syncing&&g.needsSync){g.syncing=1;g.syncer||(g.syncer=new Doneski.Synchro(g));if(g.syncer.onLine){g.newJournal();f=(l=localStorage)[(j="journal.")+"unsynced"].split(",");for(h in f)l[j+h]&&(k=k||[]).push("["+h+","+l[j+h]+"]");k=k.join(",");g.upload(k)}else console.log("offline");g.syncing=0}},upload:function(f,h){try{h=new XMLHttpRequest,h.open("POST","/sync",1),h.onreadystatechange=g.upback,h.send(f)}catch(k){return 0}return 1},
upback:function(f,o){if(f.target.readyState==4){o=f.target.responseText.split(",");for(h in o)(l=localStorage)[(j="journal.")+"unsynced"].replace(RegExp("^"+(n=o[h])+",|,"+n+","),","),l.removeItem(j+n);g.lastSync=(new Date).getTime();l["journal.lastsync"]=g.lastSync;g.needsSync=0}},serialize:function(f){return JSON.stringify(f)}},h;for(h in o)g[h]=o[h];return new Syncer(new _Journaller(g))};
_Doneski.prototype.Synchro=function(g,o,h){var h=this,g={intervals:[3E4,9E4,36E4],retries:4,offs:0,speed:-1,_init:function(){h.ping()},online:function(){h.onLine=!1;try{var f=new XMLHttpRequest;f.open("HEAD","/ping",!1);f.send();h.onLine=!0;h.offs=0;h.setSpeed(0)}catch(g){h.onLine=!1,h.offs++,h.offs>h.retries&&h.setSpeed(parseInt(h.offs/h.retries,10))}return h.onLine},setSpeed:function(f){if(f!=h.speed&&h.intervals[f])h.timer&&window.clearInterval(h.timer),h.timer=window.setInterval(h.ping,h.intervals[f]),
h.speed=f},ping:function(){h.online()}},f;for(f in g)h[f]=g[f];h._init();return h};
_Doneski.prototype.List=function(g,o){var h=Doneski.tag,f=h("list");f.name_input=h("input",{type:"text",name:"title",placeholder:"Name this list","class":"delayed"});f.appendChild(f.name_input);f.form=h("form",{action:"/task",method:"post","class":"tasklist"});f.appendChild(f.form);f.task_input=h("input",{type:"text","class":"task",placeholder:"Add your first to-do"});f.form.appendChild(f.task_input);f.form.appendChild(h("button",{"class":"add"},"+"));f.form.appendChild(h("input",{type:"submit",value:"Add",
style:"display:none;"}));f.task_container=h("tasks",{"class":"active"});f.appendChild(f.task_container);f.completed_container=h("tasks",{"class":"completed"});f.appendChild(f.completed_container);var h={name:function(g){localStorage["lists."+f.id+".name"]=g;f.name_input.className="setted";f.task_input.focus();f.updated("name")},nameB:function(g){f.name(g.target.value)},nameK:function(g){g.keyCode==13&&f.name(g.target.value)},formHandler:function(g){g.preventDefault();Doneski.rollup();f.push(f.task_input.value);
f.task_input.value="";return!1},push:function(g){g=new Doneski.Task(f,g);f.task_container.insertBefore(g,f.task_container.firstChild);(!(l=localStorage.lists)||l.split(",").indexOf(f.id)==-1)&&f.create(f.id);f.addTask(g.id);g.addEventListener("kill",f.deathWatch,!0);g.addEventListener("update",function(f){console.log("update",f.target)},!0)},addTask:function(g){(a=f.items.indexOf(g))==-1&&f.items.push(g);f.updated("add")},updated:function(g,h){Doneski.loaded&&f.save();f.task_input.setAttribute("placeholder",
f.items.length?"Add another one":"Add your first to-do");Doneski.sFH();(h=document["create"+(e="Event")]("UI"+e+"s"))["initUI"+e](g||"update",!0,!0,window,1);h.l_id=f.id;f["dispatch"+e](h)},loadTask:function(g){g=new Doneski.Task(f,!1,g);g.completed?f.completed_container.insertBefore(g,f.completed_container.firstChild):f.task_container.insertBefore(g,f.task_container.firstChild);f.items.push(g.id);f.task_input.setAttribute("placeholder","Add another one")},create:function(f){var g=localStorage.lists?
localStorage.lists.split(","):[];g.push(f);localStorage.lists=g},save:function(){(!(l=localStorage.lists)||l.split(",").indexOf(f.id)==-1)&&f.create(f.id);localStorage["lists."+f.id]=f.items.join(",")},deathWatch:function(g){f.removeTask(g.t_id)},removeTask:function(g){(a=f.items.indexOf(g))>-1&&f.items.splice(f.items.indexOf(g),1);f.updated("remove")},focus:function(){f.task_input.focus()},activate:function(){f.className="active";f.nav_item.className="active"},deactivate:function(g){f.className=
g||"";f.nav_item.className=""}},p;for(p in h)f[p]=h[p];f.form.list=f;f.form.addEventListener("submit",f.formHandler,!0);f.name_input.addEventListener("blur",f.nameB,!0);f.name_input.addEventListener("keypress",f.nameK,!0);f.id=g;f.title=o||"";f.items=[];if(localStorage["lists."+f.id+".name"])f.name_input.value=localStorage["lists."+f.id+".name"],f.name_input.className="setted";if(localStorage["lists."+f.id]){h=localStorage["lists."+f.id].split(",");for(p=0;p<h.length;p++)f.loadTask(h[p])}f.intercepts=
["create","addTask","removeTask","name"];f.sync_intercepts=f.intercepts;f.journal=Doneski.journal;f.sync=Doneski.sync;f=new Syncer(f);return f=new _Journaller(f)};_Doneski.prototype.ListNav=function(g){var o=Doneski.tag,o=o("list",{"class":"hidden"});o.list=g;return o};
_Doneski.prototype.Task=function(g,o,h){var f=Doneski.tag("task",{});f.list=g;h&&localStorage["tasks."+h]?(o=localStorage["tasks."+h].split(Doneski.separator),g=o[0],o=o[1]=="true",f.id=h):(typeof o=="string"?(g=o,o=!1):(g=o[0],o=o[1]=="true"),f.id=Doneski.gTId());var h={taskClick:function(){f.nocancel||(f.className+=" clicky",f.completed?window.setTimeout(function(){f.uncomplete()},1E3):window.setTimeout(function(){f.complete()},1E3));f.nocancel=!1},taskMove:function(){f.nocancel=!0},save:function(){f.killed&&
localStorage.removeItem("tasks."+f.id)||(localStorage["tasks."+f.id]=[f.innerHTML,f.completed].join(Doneski.separator))},complete:function(){f.className="";f.list.completed_container.insertBefore(f,f.list.completed_container.firstChild);f.completed=!0;f.updated("complete")},uncomplete:function(){f.list.task_container.insertBefore(f,f.list.task_container.firstChild);f.className="active";f.completed=!1;f.updated("uncomplete")},kill:function(){f.killed&&f.updated("kill")},updated:function(g,h){Doneski.loaded&&
f.save();Doneski.sFH();(h=document["create"+(e="Event")]("UI"+e+"s"))["initUI"+e](g||"update",!0,!0,window,1);h.t_id=f.id;f["dispatch"+e](h);console.log("dispatched",g)},setText:function(g){f.innerHTML=g}},p;for(p in h)f[p]=h[p];f.addEventListener("click",f.taskClick,!0);f.addEventListener("touchmove",f.taskMove,!0);f.addEventListener("touchend",f.taskClick,!0);f.completed=o;if(!f.completed)f.className="active";f.intercepts=["complete","uncomplete","kill","setText"];f.sync_intercepts=f.intercepts;
f.journal=Doneski.journal;f.sync=Doneski.sync;f=new Syncer(f);f=new _Journaller(f);f.setText(g);f.save();return f};
var _Journaller=function(g,o,h,f,p,k){if(g.intercepts)for(var p=function(f){return JSON.stringify(f)},f=function(){g.journal&&g.journal.call?g.journal(Array.prototype.slice.call(arguments)):console.log("Journal: "+p(Array.prototype.slice.call(arguments)))},h=function(h,k){k=Array.prototype.slice.call(k);f(g.id,h,k);return s[h].apply(g,k)},s=[],k=0;k<g.intercepts.length;k++)s[m=g.intercepts[k]]=g[m],function(f,g){g&&(f[g]=function(){h.apply(f,[g,arguments])})}(g,m);return g},Syncer=function(g,o,h,
f){if(g.sync_intercepts){o=function(){g.sync&&g.sync.call&&g.sync(Array.prototype.slice.call(arguments))};h=function(h,k){o(g.id,h,k=Array.prototype.slice.call(k));return f[h].apply(g,k)};f=[];for(i=0;i<g.sync_intercepts.length;i++)f[m=g.sync_intercepts[i]]=g[m],function(f,g){g&&(f[g]=function(){h.apply(f,[g,arguments])})}(g,m)}return g};window.Doneski=new _Doneski;window.applicationCache.addEventListener("updateready",function(){window.applicationCache.swapCache()},!0);
window.setTimeout("Doneski._init();",0);
