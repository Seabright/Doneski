var _Doneski=function(){var f=this;f.linger=1E3;f.list_name="default";f.separator="::";f.tag=function(f,h,r){f=document.createElement(f);!r&&typeof h=="string"&&(r=h=void 0);if(h)for(var o in h)f.setAttribute(o,h[o]);if(r)f.innerHTML=r;return f};f.bind=function(k,h){h=h||f;return function(){k.apply(h,arguments)}};f.l=[];var p={_init:function(){f.lcon=(gtn=f.gtn)((l="list")+"s")[0];f.ln=gtn(l+"nav")[0];f.tb=t=gtn(tb="toolbar")[0];f.fudge=gtn("content")[0];if((ls="localStorage")in(w=window)&&w[ls]!==
null){f.touch();f.currentJournal=parseInt(w[ls][(j="journal.")+"current"]||1,10);f.lastSync=parseInt(w[ls][j+"lastsync"]||0,10);if(!w[ls][j+"started"])f.do_journal=!0;w.scrollTo(0,35);if(localStorage[l+"s"]){var k=w[ls][l+"s"].split(",");f.rollup();for(var h=0;h<k.length;h++)f.lL(k[h]);(k=w[ls]["last_"+l]?f.find(w[ls]["last_"+l]):f.l[0])||(k=f.l[0]);f.go(k)}else f.newList();f.sFH()}(ael=f.ael)("keyup",f.bkp,!0);if(typeof TouchyFeely!="undefined")f.toucher=new TouchyFeely(document,{mL:10,cscroll:0}),
ael((a="swipe")+"start",f.swS,!0),ael(a+"move",f.swM,!0),ael(a+"end",f.swE,!0),ael((a="scroll")+"start",f.scS,!0),ael(a+"move",f.scM,!0),ael(a+"end",f.scE,!0);(st=w.setTimeout)(function(){f.gtn("body")[0].className+=" loaded"},200);st(function(){f.cachedTexture(tb,f.ns,{opacity:0.3,range:50},tb)},0);st(function(){f.cachedTexture("body "+l+"s "+l,f.nb,{bg:{position:"20px top",repeat:"repeat-y"}},"nb")},0);st(function(){f.cachedTexture("body header",f.nb,{bg:{position:"20px top",repeat:"repeat-y"}},
"nb")},0);w.scrollTo(0,0);st(f.sync,1E3);w[ls][j+"started"]=1;f.loaded=f.do_journal=f.do_sync=!0},ael:function(f,h,o){return document.addEventListener(f,h,o)},gtn:function(f){return document.getElementsByTagName(f)},ns:function(f,h,o,q){h={opacity:0.2,range:100};if(f)for(var v in f)h[v]=f[v];if(!(d=document)[ce="createElement"]("canvas").getContext)return!1;q=(o=d[ce]("canvas")).getContext("2d");o.width=h.width||960;o.height=h.height||30;for(f=0;f<o.width;f++)for(v=0;v<o.height;v++){var p=Math.floor(Math.random()*
h.range);q.fillStyle="rgba("+p+","+p+","+p+","+h.opacity+")";q.fillRect(f,v,1,1)}return"url("+o.toDataURL("image/png")+")"},nb:function(f,h,o,q,p,u){if(!(q=document)[ce="createElement"]("canvas").getContext)return!1;u=(p=q[ce]("canvas")).getContext("2d");p.width=4;p.height=1;u.fillStyle="rgba(236,0,140,.2)";u.fillRect(0,0,1,1);u.fillRect(3,0,1,1);return"url("+p.toDataURL("image/png")+")"},cachedTexture:function(k,h,o,q,p,u,x){q&&(w=window)[ls="localStorage"][q="tx."+q]&&(u=w[ls][q]);p={bg:{repeat:"no-repeat",
position:"left top"}};if(o)for(x in o)p[x]=o[x];u||(u=h(o),w[ls][q]=u);(st=f.styles()).innerHTML+=k+"{"+(b="background-")+"image:"+u+";";for(x in bg=p.bg)st.innerHTML+=b+x+":"+bg[x]+";";st.innerHTML+="}\n";return!0},styles:function(){if(f.css)return f.css;f.css=(d=document).createElement("style");d.getElementsByTagName("head")[0].appendChild(f.css);return f.css},swS:function(){(g=(f.swT=f.cL)["get"+(a="Attribute")]("style")||"").indexOf(w="-webkit-transform:translate3d(");f.swiping=!0},swM:function(){},
swE:function(k){(function(f){window.setTimeout(function(){f.removeAttribute("style")},200)})(f.swT);k.direction=="left"?f.goN():f.goP()},scS:function(){(a=(f.scT=f.cL).getAttribute("style")||"").indexOf(w="-webkit-transform:translate3d(")==-1?(f.scT.setAttribute("style",a+w+"0px,0px,0px);-webkit-transition:none;"),f.scS=0):f.scS=parseInt(a.replace(/.*-webkit-transform:translate3d\((-)?[0-9]{1,5}(px)?,((-)?[0-9]{1,5})(px)?,.*/,"$3"),10)},scM:function(k,h){h=(e=f.scS+k.dY)>0?0:e<(d=f.mSc())?d:e;f.scT.setAttribute("style",
f.scT.getAttribute("style").replace(/-webkit-transform:translate3d\(((-)?[0-9]{1,5}(px)?),(-)?[0-9]{1,5}(px)?,/,"-webkit-transform:translate3d($1,"+h+"px,"))},scE:function(){f.scT.setAttribute("style",f.scT.getAttribute("style").replace("-webkit-transition:none;",""))},mSc:function(){return 0-f.scT.clientHeight+window.innerHeight},lL:function(k,h,o,q){(o=new Doneski.List(k)).nav_item=q=new Doneski.ListNav(o);f.l.push(o);h&&(o.className+=h);f.lcon.appendChild(o);f.ln.appendChild(q);f.rN();return o},
rN:function(){ln=f.ln;if(ln.clientWidth>f.tb.clientWidth*0.9){a="tight";for(o=4;o--;)ln.className=ln.className.replace(a+(o-1),a+o)}},newList:function(){var k=f.lL(f.gLId(),"after");f.go(k)},find:function(k){for(var h=0;h<f.l.length;h++)if(f.l[h].id==k)return f.l[h]},go:function(k){for(var h="",o=0;o<f.l.length;o++)f.l[o]!=k?f.l[o].deactivate(h):(f.l[o].activate(),h="after");f.cL=k;f.sFH();localStorage.last_list=k.id},sFH:function(){(s=f.styles())&&s.innerHTML.indexOf("/*fudge heights*/")==-1?f.styles().innerHTML+=
"\n/*fudge heights*/content,lists list{min-height:"+window.innerHeight+"px;}":f.styles().innerHTML.replace("\n/*fudge heights*/content,lists list{[^}]+}","\n/*fudge heights*/content,lists list{min-height:"+window.innerHeight+"px;}")},goN:function(){var k=f.l.indexOf(f.cL)+1;k>=f.l.length?f.newList():f.go(f.l[k])},goP:function(){var k=f.l.indexOf(f.cL)-1;k>=0&&f.go(f.l[k])},gTId:function(){return"t_"+f.gUU()},gLId:function(){return"l_"+f.gUU()},gUU:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(f){var h=Math.random()*16|0;return(f=="x"?h:h&3|8).toString(16)})+""},saveLists:function(){for(var k=[],h=0;h<f.l.length;h++)k.push(f.l[h].id);localStorage.lists=k},store:function(){localStorage.lists=[f.list_name,!1];var k=[],h;for(h in f.tasks){var o=[h,f.tasks[h]].join(f.separator);f.tasks[h]||k.push(o)}localStorage["lists."+f.list_name]=k.join(",")},rollup:function(){if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("compact")<0)bdy.className+=" compact";window.scrollTo(0,
0)},rollupQuick:function(){if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("quick")<0)bdy.className+=" quick";if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("compact")<0)bdy.className+=" compact";window.scrollTo(0,0)},add:function(){},touch:function(){f.hLS()&&(localStorage.lastSeen=new Date)},lastSeen:function(){return f.hLS()&&localStorage.lastSeen},hLS:function(){return"localStorage"in window&&window.localStorage!==null},ping:function(){},bkp:function(k){k.keyCode==
39?f.goN():k.keyCode==37&&f.goP()},intercepts:[],queue:[0,1,2,3,4,5,6,7,8,9],newJournal:function(){(l=localStorage)[(j="journal.")+"unsynced"]||((l=localStorage)[(j="journal.")+"unsynced"]="");if(f[c="currentJournal"])(l=localStorage)[(j="journal.")+"unsynced"]+=f[c]+",";f[c]=f[c]?f[c]+1:1;l[j+"current"]=f[c]},journal:function(){if(f.do_journal)(a=Array.prototype.slice.call(arguments)[0]).unshift((new Date).getTime()-(d=f.queue.shift())),f.queue.push(f.queue[f.queue.length-1]+1),localStorage["journal."+
f.currentJournal]=f.serialize(a),f.newJournal(),f.needsSync=1},sync:function(k,h,o){if(f.do_sync&&!f.syncing&&f.needsSync){f.syncing=1;f.syncer||(f.syncer=new Doneski.Synchro(f));if(f.syncer.online()){k=(l=localStorage)[(j="journal.")+"unsynced"].split(",");for(h in k)l[j+h]&&(o=o||[]).push([parseInt(h,10),JSON.parse(l[j+h])]);f.upload(f.serialize({lastsync:f.lastSync,account:"test",device:"test",data:o}))}f.syncing=0}},upload:function(k,h){try{h=new XMLHttpRequest,h.open("POST","/sync",1),h.onreadystatechange=
f.upback,h.send(k)}catch(o){return 0}return 1},upback:function(k,h,p){if(k.target.readyState==4){h=eval("("+k.target.responseText+")");for(o in p=h.synced)(l=localStorage)[(j="journal.")+"unsynced"].replace(RegExp("^"+(n=p[o])+",|,"+n+","),","),l.removeItem(j+n);f.replay(h.replay);f.justsynced();f.needsSync=0}},justsynced:function(){f.lastSync=(new Date).getTime();l["journal.lastsync"]=f.lastSync},replay:function(k){f.replaying=1;for(o=0;o<k.length;o++){var h=eval("("+k[o]+")");console.log(h)}f.replaying=
0;return!0},serialize:function(f){return JSON.stringify(f)}},o;for(o in p)f[o]=p[o];return new Syncer(new _Journaller(f))};
_Doneski.prototype.Synchro=function(f,p,o){var o=this,f={intervals:[3E4,9E4,36E4],retries:4,offs:0,speed:-1,_init:function(){},online:function(){o.onLine=0;try{var f=new XMLHttpRequest;f.open("HEAD","/ping",0);f.send();o.onLine=1;o.offs=0;o.setSpeed(0)}catch(k){o.onLine=0,o.offs++,o.offs>o.retries&&o.setSpeed(parseInt(o.offs/o.retries,10))}return o.onLine},setSpeed:function(f){if(f!=o.speed&&o.intervals[f])o.timer&&window.clearInterval(o.timer),o.timer=window.setInterval(o.ping,o.intervals[f]),o.speed=
f},ping:function(){o.online()}},k;for(k in f)o[k]=f[k];o._init(p);return o};
_Doneski.prototype.List=function(f,p,o,k){var o=Doneski.tag,h=o("list");h.name_input=o("input",{type:"text",name:"title",placeholder:"Name this list","class":"delayed"});h.appendChild(h.name_input);h.form=o("form",{action:"/task",method:"post","class":"tasklist"});h.appendChild(h.form);h.task_input=o("input",{type:"text","class":"task",placeholder:"Add your first to-do"});h.form.appendChild(h.task_input);h.form.appendChild(o("input",{type:"submit",value:"Add",style:"display:none;"}));h.task_container=
o("tasks",{"class":"active"});h.appendChild(h.task_container);h.completed_container=o("tasks",{"class":"completed"});h.appendChild(h.completed_container);var o={name:function(f){localStorage["lists."+h.id+".name"]=f;h.name_input.className="setted";h.task_input.focus();h.updated("name")},nameB:function(f){h.name(f.target.value)},nameK:function(f){f.keyCode==13&&h.name(f.target.value)},formHandler:function(f){f.preventDefault();Doneski.rollup();h.push(h.task_input.value);h.task_input.value="";return!1},
push:function(f){f=new Doneski.Task(h,f);h.task_container.insertBefore(f,h.task_container.firstChild);(!(l=localStorage.lists)||l.split(",").indexOf(h.id)==-1)&&h.create(h.id);h.addTask(f.id);f.addEventListener("kill",h.deathWatch,!0);f.addEventListener("update",function(){},!0)},addTask:function(f){(a=h.items.indexOf(f))==-1&&h.items.push(f);h.updated("add")},updated:function(f,k){Doneski.loaded&&h.save();h.task_input.setAttribute("placeholder",h.items.length?"Add another one":"Add your first to-do");
Doneski.sFH();(k=document["create"+(e="Event")]("UI"+e+"s"))["initUI"+e](f||"update",!0,!0,window,1);k.l_id=h.id;h["dispatch"+e](k)},loadTask:function(f){f=new Doneski.Task(h,!1,f);f.completed?h.completed_container.insertBefore(f,h.completed_container.firstChild):h.task_container.insertBefore(f,h.task_container.firstChild);h.items.push(f.id);h.task_input.setAttribute("placeholder","Add another one")},create:function(f){var h=localStorage.lists?localStorage.lists.split(","):[];h.push(f);localStorage.lists=
h},save:function(){(!(l=localStorage.lists)||l.split(",").indexOf(h.id)==-1)&&h.create(h.id);localStorage["lists."+h.id]=h.items.join(",")},deathWatch:function(f){h.removeTask(f.t_id)},removeTask:function(f){(a=h.items.indexOf(f))>-1&&h.items.splice(h.items.indexOf(f),1);h.updated("remove")},focus:function(){h.task_input.focus()},activate:function(){h.className="active";h.nav_item.className="active";h.old_style&&h.setAttribute("style",h.old_style)},deactivate:function(f){h.className=f||"";h.nav_item.className=
"";h.old_style=h.getAttribute("style");h.removeAttribute("style")}},r;for(r in o)h[r]=o[r];h.form.list=h;h.form.addEventListener("submit",h.formHandler,!0);h.name_input.addEventListener("blur",h.nameB,!0);h.name_input.addEventListener("keypress",h.nameK,!0);h.id=f;h.title=p||"";h.items=[];if(localStorage["lists."+h.id+".name"])h.name_input.value=localStorage["lists."+h.id+".name"],h.name_input.className="setted";if(localStorage["lists."+h.id]&&(k=localStorage["lists."+h.id].split(",")))for(r=0;r<
k.length;r++)h.loadTask(k[r]);h.intercepts=["create","addTask","removeTask","name"];h.sync_intercepts=h.intercepts;h.journal=Doneski.journal;h.sync=Doneski.sync;h=new Syncer(h);return h=new _Journaller(h)};_Doneski.prototype.ListNav=function(f){var p=Doneski.tag,p=p("list",{"class":"hidden"});p.list=f;return p};
_Doneski.prototype.Task=function(f,p,o){var k=Doneski.tag("task",{});k.list=f;o&&localStorage["tasks."+o]?(p=localStorage["tasks."+o].split(Doneski.separator),f=p[0],p=p[1]=="true",k.id=o):(typeof p=="string"?(f=p,p=!1):(f=p[0],p=p[1]=="true"),k.id=Doneski.gTId());var o={taskClick:function(){k.nocancel||(k.className+=" clicky",k.completed?window.setTimeout(function(){k.uncomplete()},1E3):window.setTimeout(function(){k.complete()},1E3));k.nocancel=!1},taskMove:function(){k.nocancel=!0},save:function(){k.killed?
localStorage.removeItem("tasks."+k.id):localStorage["tasks."+k.id]=[k.innerHTML,k.completed].join(Doneski.separator)},complete:function(){k.className="";k.list.completed_container.insertBefore(k,k.list.completed_container.firstChild);k.completed=!0;k.updated("complete")},uncomplete:function(){k.list.task_container.insertBefore(k,k.list.task_container.firstChild);k.className="active";k.completed=!1;k.updated("uncomplete")},kill:function(){k.killed&&k.updated("kill")},updated:function(f,h){Doneski.loaded&&
k.save();Doneski.sFH();(h=document.createEvent("UIEvents")).initUIEvent(f||"update",!0,!0,window,1);h.t_id=k.id;k.dispatchEvent(h)},setText:function(f){k.innerHTML=f}},h;for(h in o)k[h]=o[h];k.addEventListener("click",k.taskClick,!0);k.addEventListener("touchmove",k.taskMove,!0);k.addEventListener("touchend",k.taskClick,!0);k.completed=p;if(!k.completed)k.className="active";k.intercepts=["complete","uncomplete","kill","setText","create"];k.sync_intercepts=k.intercepts;k.journal=Doneski.journal;k.sync=
Doneski.sync;k=new Syncer(k);k=new _Journaller(k);k.setText(f);k.save();return k};
var _Journaller=function(f,p,o,k,h,r){if(f.intercepts)for(var k=function(){f.journal&&f.journal.call&&f.journal(Array.prototype.slice.call(arguments))},o=function(h,o){f.replaying||(o=Array.prototype.slice.call(o),k(f.id,h,o));return q[h].apply(f,o)},q=[],r=0;r<f.intercepts.length;r++)q[m=f.intercepts[r]]=f[m],function(f,h){h&&(f[h]=function(){o.apply(f,[h,arguments])})}(f,m);window.o_register||(window.o_register={});return window.o_register[f.id]=f},Syncer=function(f,p,o,k){if(f.sync_intercepts){p=
function(){f.sync&&f.sync.call&&f.sync(Array.prototype.slice.call(arguments))};o=function(h,o){p(f.id,h,o=Array.prototype.slice.call(o));return k[h].apply(f,o)};k=[];for(i=0;i<f.sync_intercepts.length;i++)k[m=f.sync_intercepts[i]]=f[m],function(f,k){k&&(f[k]=function(){o.apply(f,[k,arguments])})}(f,m)}return f};window.Doneski=new _Doneski;window.applicationCache.addEventListener("updateready",function(){window.applicationCache.swapCache()},!0);window.setTimeout("Doneski._init();",0);
