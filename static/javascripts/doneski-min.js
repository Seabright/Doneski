var _Doneski=function(){var b=this;b.linger=1E3;b.list_name="default";b.separator="::";b.tag=function(a,b,e){a=document.createElement(a);!e&&typeof b=="string"&&(e=b=void 0);if(b)for(var d in b)a.setAttribute(d,b[d]);if(e)a.innerHTML=e;return a};b.bind=function(a,c){c=c||b;return function(){a.apply(c,arguments)}};b.lists=[];var f={_init:function(){b.lists_container=document.body.getElementsByTagName("lists")[0];b.list_nav=document.body.getElementsByTagName("listnav")[0];b.toolbar=document.body.getElementsByTagName("toolbar")[0];
b.fudge=document.body.getElementsByTagName("content")[0];if("localStorage"in window&&window.localStorage!==null){b.touch();window.scrollTo(0,35);if(localStorage.lists){var a=localStorage.lists.split(",");b.rollup();for(var c=0;c<a.length;c++)b.loadList(a[c]);(a=localStorage.last_list?b.find(localStorage.last_list):b.lists[0])||(a=b.lists[0]);b.go(a)}else b.newList();b.setFudgeHeight()}window.addEventListener("keyup",b.bkp,!0);if(typeof TouchyFeely!="undefined")b.toucher=new TouchyFeely(document,{capturescroll:!1}),
document.addEventListener("swipestart",b.swipeStarter,!0),document.addEventListener("swipemove",b.swipeMoveHandler,!0),document.addEventListener("swipeend",b.swipeHandler,!0),document.addEventListener("scrollstart",b.scrollStart,!0),document.addEventListener("scrollmove",b.scrollHandler,!0);window.setTimeout(function(){document.getElementsByTagName("body")[0].className+=" loaded"},500);window.setTimeout(function(){b.noisify(b.toolbar,{opacity:0.3,range:50})},0);window.setTimeout(function(){b.notebookify(document.body.getElementsByTagName("content")[0])},
0);window.scrollTo(0,0);b.loaded=!0},noisify:function(a,b){var e={opacity:0.2,range:100};if(b)for(var d in b)e[d]=b[d];if(!document.createElement("canvas").getContext)return!1;d=(canvas=document.createElement("canvas")).getContext("2d");canvas.width=a.clientWidth;canvas.height=a.clientHeight;for(var f=0;f<canvas.width;f++)for(var g=0;g<canvas.height;g++){var h=Math.floor(Math.random()*e.range);d.fillStyle="rgba("+h+","+h+","+h+","+e.opacity+")";d.fillRect(f,g,1,1)}a.style.backgroundImage="url("+canvas.toDataURL("image/png")+
")";return!0},notebookify:function(a){if(!document.createElement("canvas").getContext)return!1;var b=document.createElement("canvas"),e=b.getContext("2d");b.width=4;b.height=1;e.fillStyle="rgba(236,0,140,.2)";e.fillRect(0,0,1,1);e.fillRect(3,0,1,1);a.style.backgroundImage="url("+b.toDataURL("image/png")+")";a.style.backgroundRepeat="repeat-y";a.style.backgroundPosition="20px top";return!0},swipeStarter:function(){},swipeHandler:function(a){a.direction=="left"?b.goNext():b.goPrevious()},swipeMoveHandler:function(){},
scrollHandler:function(a){if((top=b.scrollstart-a.vD)<0)top=0;if(top>(max=b.maxScroll()))top=max;window.scrollTo(0,top)},scrollStart:function(){b.scrollstart=window.pageYOffset||window.scrollY},maxScroll:function(){return document.body.clientHeight-window.innerHeight},loadList:function(a){var a=new Doneski.List(a),c=new Doneski.ListNav(a);a.nav_item=c;b.lists.push(a);b.lists_container.appendChild(a);b.list_nav.appendChild(c);b.rejig_nav();return a},rejig_nav:function(){if(b.list_nav.clientWidth>b.toolbar.clientWidth*
0.9)b.list_nav.className=b.list_nav.className.replace("tight2","tight3"),b.list_nav.className=b.list_nav.className.replace("tight1","tight2"),b.list_nav.className=b.list_nav.className.replace("notight","tight1")},newList:function(){var a=b.loadList(b.generateListId());a.className="after";window.setTimeout(function(){b.go(a)},200)},find:function(a){for(var c=0;c<b.lists.length;c++)if(b.lists[c].id==a)return b.lists[c]},go:function(a){for(var c="",e=0;e<b.lists.length;e++)b.lists[e]!=a?b.lists[e].deactivate(c):
(b.lists[e].activate(),b.fudge.style.height=a.clientHeight,c="after");b.current_list=a;b.setFudgeHeight();localStorage.last_list=a.id},setFudgeHeight:function(){b.fudge.style.height=((cL=b.current_list.clientHeight+50)>window.innerHeight?cL:window.innerHeight)+"px";window.setTimeout(function(){b.setFudgeHeight()},200)},goNext:function(){var a=b.lists.indexOf(b.current_list)+1;a>=b.lists.length?b.newList():b.go(b.lists[a])},goPrevious:function(){var a=b.lists.indexOf(b.current_list)-1;a>=0&&b.go(b.lists[a])},
generateTaskId:function(){return"t_"+b.generateUUID()},generateListId:function(){return"l_"+b.generateUUID()},generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0;return(a=="x"?b:b&3|8).toString(16)})+""},saveLists:function(){for(var a=[],c=0;c<b.lists.length;c++)a.push(b.lists[c].id);localStorage.lists=a},store:function(){localStorage.lists=[b.list_name,!1];var a=[],c;for(c in b.tasks){var e=[c,b.tasks[c]].join(b.separator);b.tasks[c]||
a.push(e)}localStorage["lists."+b.list_name]=a.join(",")},rollup:function(){if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("compact")<0)bdy.className+=" compact";window.scrollTo(0,0)},rollupQuick:function(){if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("quick")<0)bdy.className+=" quick";if((bdy=document.getElementsByTagName("body")[0])&&bdy.className.indexOf("compact")<0)bdy.className+=" compact";window.scrollTo(0,0)},add:function(){},touch:function(){b.hasLocalStorage()&&
(localStorage.lastSeen=new Date)},lastSeen:function(){return b.hasLocalStorage()&&localStorage.lastSeen},hasLocalStorage:function(){return"localStorage"in window&&window.localStorage!==null},ping:function(){console.log("Yeah yeah.",b)},bkp:function(a){a.keyCode==39?b.goNext():a.keyCode==37&&b.goPrevious()},swipe:function(){},intercepts:[],intercept:function(a){if(a.intercepts)for(var b=0;b<a.intercepts.length;b++){var e=a[a.intercepts[b]];e&&console.log(e.constructor)}},perform:function(){var a=Array.prototype.slice.call(arguments),
c=a.shift(),e=a.shift();b.journal(c,e,a);return c[e].apply(c,a)},journal:function(){console.log(b.serialize(Array.prototype.slice.call(arguments)))},serialize:function(a){return JSON.stringify(a)}},d;for(d in f)b[d]=f[d]};
_Doneski.prototype.List=function(b,f){var d=Doneski.tag,a=d("list");a.name_input=d("input",{type:"text",name:"title",placeholder:"Name this list","class":"delayed"});a.appendChild(a.name_input);a.form=d("form",{action:"/task",method:"post","class":"tasklist"});a.appendChild(a.form);a.task_input=d("input",{type:"text","class":"task",placeholder:"Add your first to-do"});a.form.appendChild(a.task_input);a.form.appendChild(d("button",{"class":"add"},"+"));a.form.appendChild(d("input",{type:"submit",value:"Add",
style:"display:none;"}));a.task_container=d("tasks",{"class":"active"});a.appendChild(a.task_container);a.completed_container=d("tasks",{"class":"completed"});a.appendChild(a.completed_container);var d={name:function(b){localStorage["lists."+a.id+".name"]=b;a.name_input.className="setted";a.task_input.focus()},nameB:function(b){a.name(b.target.value)},nameK:function(b){b.keyCode==13&&a.name(b.target.value)},formHandler:function(b){b.preventDefault();Doneski.rollup();a.push(a.task_input.value);a.task_input.value=
"";return!1},taskMove:function(a){a.target.nocancel=!0},push:function(b){b=new Doneski.Task(a,b);a.task_container.insertBefore(b,a.task_container.firstChild);a.items.push(b.id);Doneski.loaded&&a.save();a.task_input.setAttribute("placeholder","Add another one");Doneski.setFudgeHeight()},loadTask:function(b){b=new Doneski.Task(a,!1,b);b.completed?a.completed_container.insertBefore(b,a.completed_container.firstChild):a.task_container.insertBefore(b,a.task_container.firstChild);a.items.push(b.id);a.task_input.setAttribute("placeholder",
"Add another one")},save:function(){if(!localStorage.lists||localStorage.lists.split(",").indexOf(a.id)==-1){var b=localStorage.lists?localStorage.lists.split(","):[];b.push(a.id);localStorage.lists=b}localStorage["lists."+a.id]=a.items.join(",")},remove:function(b){b.className=b.className.replace("active","");window.setTimeout(function(){b.parentNode.removeChild(b)},200);a.items[b.innerHTML]=!0;a.save()},focus:function(){a.task_input.focus()},activate:function(){a.className="active";a.nav_item.className=
"active"},deactivate:function(b){a.className=b||"";a.nav_item.className=""}},c;for(c in d)a[c]=d[c];a.form.list=a;a.form.addEventListener("submit",a.formHandler,!0);a.name_input.addEventListener("blur",a.nameB,!0);a.name_input.addEventListener("keypress",a.nameK,!0);a.id=b;a.title=f||"";a.items=[];if(localStorage["lists."+a.id+".name"])a.name_input.value=localStorage["lists."+a.id+".name"],a.name_input.className="setted";if(localStorage["lists."+a.id]){d=localStorage["lists."+a.id].split(",");for(c=
0;c<d.length;c++)a.loadTask(d[c])}return a};_Doneski.prototype.ListNav=function(b){var f=Doneski.tag,f=f("list",{"class":"hidden"});f.list=b;return f};
_Doneski.prototype.Task=function(b,f,d){var a=Doneski.tag("task",{});a.list=b;d&&localStorage["tasks."+d]?(f=localStorage["tasks."+d].split(Doneski.separator),b=f[0],f=f[1]=="true",a.id=d):(typeof f=="string"?(b=f,f=!1):(b=f[0],f=f[1]=="true"),a.id=Doneski.generateTaskId());a.innerHTML=b;var d={taskClick:function(){!a.nocancel&&a.clickable&&(a.className+=" clicky",a.completed?window.setTimeout(function(){a.uncomplete()},1E3):window.setTimeout(function(){a.complete()},1E3));a.nocancel=!1},taskMove:function(){a.nocancel=
!0},save:function(){localStorage["tasks."+a.id]=[a.innerHTML,a.completed].join(Doneski.separator)},complete:function(){console.log("complete");a.className="";a.list.completed_container.insertBefore(a,a.list.completed_container.firstChild);a.completed=!0;a.save()},uncomplete:function(){console.log("uncomplete");a.list.task_container.insertBefore(a,a.list.task_container.firstChild);a.className="active";a.completed=!1;a.save()},focus:function(){}},c;for(c in d)a[c]=d[c];a.clickable=!0;a.addEventListener("click",
a.taskClick,!0);a.addEventListener("touchmove",a.taskMove,!0);a.addEventListener("touchend",a.taskClick,!0);a.completed=f;a.completed||window.setTimeout(function(){a.className="active"},1);a.save();return a};window.Doneski=new _Doneski;window.applicationCache.addEventListener("updateready",function(){window.applicationCache.swapCache()},!0);window.setTimeout("Doneski._init();",0);
